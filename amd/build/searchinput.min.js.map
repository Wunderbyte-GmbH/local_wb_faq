{"version":3,"file":"searchinput.min.js","sources":["../src/searchinput.js"],"sourcesContent":["\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/*\n * @package    local_wunderbyte_table\n * @copyright  Wunderbyte GmbH <info@wunderbyte.at>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport Templates from 'core/templates';\nimport {get_string as getString} from 'core/str';\nimport {increaseCounter} from \"local_wb_faq/faqnavbar\";\n\nvar searcharray = [];\n\nexport const searchInput = (inputClass, elementToHide, elementToSearch, uid) => {\n\n    // eslint-disable-next-line no-console\n    console.log('searchinput uid: ', uid);\n\n    let input, filter, li, a, i, txtValue;\n    input = document.querySelector(inputClass);\n    filter = input.value.toUpperCase();\n    li = document.querySelectorAll(elementToHide);\n    for (i = 0; i < li.length; i++) {\n        a = li[i].querySelector(elementToSearch);\n        txtValue = a.textContent || a.innerText;\n\n        if (txtValue.toUpperCase().indexOf(filter) > -1) {\n            li[i].style.display = \"\";\n        } else {\n            li[i].style.display = \"none\";\n        }\n    }\n};\n\nexport const searchJSON = (listContainer, inputClass, json) => {\n    let arr = [];\n    // Select Container\n    // eslint-disable-next-line no-console\n    console.log(listContainer, inputClass, Object.values(json));\n    let container = document.querySelector(listContainer);\n    let searchVal = document.querySelector(inputClass).value.toUpperCase();\n\n    // Make sure we have parsed json.\n    if (typeof json === 'string') {\n        json = JSON.parse(json);\n    }\n\n    // eslint-disable-next-line no-console\n    console.log(searchVal);\n    if (searchVal.length > 3) {\n        let i = 0;\n        Object.values(json).forEach(e=>{\n             if ((e.content && e.content.toUpperCase().indexOf(searchVal) > -1)\n                || (e.title && e.title.toUpperCase().indexOf(searchVal) > -1)) {\n                arr[i] = e;\n                if (e.type == 0) {\n                    arr[i].iscategory = true;\n                }\n                i++;\n            }\n        });\n\n        for (let i = 0; i < arr.length; i++) {\n\n            if (typeof searcharray[i] === 'undefined') {\n                render(arr, container);\n                break;\n            }\n\n            if (arr[i].id != searcharray[i].id) {\n\n                render(arr, container);\n                break;\n            }\n        }\n        searcharray = arr;\n\n        if (searcharray.length < 1) {\n            getString('noresult', 'local_wb_faq').then(value => {\n\n                // eslint-disable-next-line no-console\n                console.log(value);\n                container.innerHTML = value;\n                return;\n            }).catch(e => {\n                // eslint-disable-next-line no-console\n                console.log(e);\n            });\n            // If we didn't find anything, we just increase the counter.\n            // User might need to search a few times.\n            increaseCounter();\n        } else {\n            // If we had a valid input, we allow to continue to the input form.\n            increaseCounter(true);\n        }\n\n    } else if (searchVal.length == 0) {\n\n        container.innerHTML = '';\n        searcharray = [];\n\n    } else {\n\n        getString('stringtooshort', 'local_wb_faq').then(value => {\n\n            // eslint-disable-next-line no-console\n            console.log(value);\n            container.innerHTML = value;\n            return;\n        }).catch(e => {\n            // eslint-disable-next-line no-console\n            console.log(e);\n        });\n\n        searcharray = [];\n\n    }\n};\n\nexport const init = (searchInputID, listContainer, elementToHide, elementToSearch, json = null) => {\n    // eslint-disable-next-line no-console\n    console.log(\"initSearch\", searchInputID, listContainer);\n\n    const searchInputElement = document.querySelector(searchInputID);\n\n    if (searchInputElement) {\n        searchInputElement.addEventListener('keyup', function () {\n            searchJSON(listContainer, searchInputID, json);\n        });\n    }\n};\n\n\nexport const render = (data, container) => {\n    // Render\n    // eslint-disable-next-line no-console\n    console.log(container);\n\n    Templates.renderForPromise('local_wb_faq/searchbox', data).then(({html}) => {\n        container.innerHTML = \"\";\n        container.insertAdjacentHTML('afterbegin', html);\n        return;\n    }).catch(e => {\n        // eslint-disable-next-line no-console\n        console.log(e);\n    });\n};"],"names":["searcharray","inputClass","elementToHide","elementToSearch","uid","input","filter","li","a","i","txtValue","console","log","document","querySelector","value","toUpperCase","querySelectorAll","length","textContent","innerText","indexOf","style","display","searchJSON","listContainer","json","arr","Object","values","container","searchVal","JSON","parse","forEach","e","content","title","type","iscategory","render","id","then","innerHTML","catch","searchInputID","searchInputElement","addEventListener","data","renderForPromise","_ref","html","insertAdjacentHTML"],"mappings":";;;;;6MAyBIA,YAAc,wBAES,CAACC,WAAYC,cAAeC,gBAAiBC,WAKhEC,MAAOC,OAAQC,GAAIC,EAAGC,EAAGC,aAF7BC,QAAQC,IAAI,oBAAqBR,KAGjCC,MAAQQ,SAASC,cAAcb,YAC/BK,OAASD,MAAMU,MAAMC,cACrBT,GAAKM,SAASI,iBAAiBf,eAC1BO,EAAI,EAAGA,EAAIF,GAAGW,OAAQT,IACvBD,EAAID,GAAGE,GAAGK,cAAcX,iBACxBO,SAAWF,EAAEW,aAAeX,EAAEY,UAE1BV,SAASM,cAAcK,QAAQf,SAAW,EAC1CC,GAAGE,GAAGa,MAAMC,QAAU,GAEtBhB,GAAGE,GAAGa,MAAMC,QAAU,cAKrBC,WAAa,CAACC,cAAexB,WAAYyB,YAC9CC,IAAM,GAGVhB,QAAQC,IAAIa,cAAexB,WAAY2B,OAAOC,OAAOH,WACjDI,UAAYjB,SAASC,cAAcW,eACnCM,UAAYlB,SAASC,cAAcb,YAAYc,MAAMC,iBAGrC,iBAATU,OACPA,KAAOM,KAAKC,MAAMP,OAItBf,QAAQC,IAAImB,WACRA,UAAUb,OAAS,EAAG,KAClBT,EAAI,EACRmB,OAAOC,OAAOH,MAAMQ,SAAQC,KAClBA,EAAEC,SAAWD,EAAEC,QAAQpB,cAAcK,QAAQU,YAAc,GACzDI,EAAEE,OAASF,EAAEE,MAAMrB,cAAcK,QAAQU,YAAc,KAC3DJ,IAAIlB,GAAK0B,EACK,GAAVA,EAAEG,OACFX,IAAIlB,GAAG8B,YAAa,GAExB9B,YAIH,IAAIA,EAAI,EAAGA,EAAIkB,IAAIT,OAAQT,IAAK,SAEH,IAAnBT,YAAYS,GAAoB,CACvC+B,OAAOb,IAAKG,oBAIZH,IAAIlB,GAAGgC,IAAMzC,YAAYS,GAAGgC,GAAI,CAEhCD,OAAOb,IAAKG,mBAIpB9B,YAAc2B,KAEET,OAAS,uBACX,WAAY,gBAAgBwB,MAAK3B,QAGvCJ,QAAQC,IAAIG,OACZe,UAAUa,UAAY5B,SAEvB6B,OAAMT,IAELxB,QAAQC,IAAIuB,wEAOA,QAGO,GAApBJ,UAAUb,QAEjBY,UAAUa,UAAY,GACtB3C,YAAc,yBAIJ,iBAAkB,gBAAgB0C,MAAK3B,QAG7CJ,QAAQC,IAAIG,OACZe,UAAUa,UAAY5B,SAEvB6B,OAAMT,IAELxB,QAAQC,IAAIuB,MAGhBnC,YAAc,kDAKF,SAAC6C,cAAepB,cAAevB,cAAeC,qBAAiBuB,4DAAO,KAEtFf,QAAQC,IAAI,aAAciC,cAAepB,qBAEnCqB,mBAAqBjC,SAASC,cAAc+B,eAE9CC,oBACAA,mBAAmBC,iBAAiB,SAAS,WACzCvB,WAAWC,cAAeoB,cAAenB,gBAMxCc,OAAS,CAACQ,KAAMlB,aAGzBnB,QAAQC,IAAIkB,8BAEFmB,iBAAiB,yBAA0BD,MAAMN,MAAKQ,WAACC,KAACA,WAC9DrB,UAAUa,UAAY,GACtBb,UAAUsB,mBAAmB,aAAcD,SAE5CP,OAAMT,IAELxB,QAAQC,IAAIuB"}