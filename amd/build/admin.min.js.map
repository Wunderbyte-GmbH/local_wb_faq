{"version":3,"file":"admin.min.js","sources":["../src/admin.js"],"sourcesContent":["\r\n// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/*\r\n * @package    local_wunderbyte_table\r\n * @copyright  Wunderbyte GmbH <info@wunderbyte.at>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\nimport Ajax from 'core/ajax';\r\nimport Templates from 'core/templates';\r\nimport DynamicForm from 'core_form/dynamicform';\r\nimport {confirmDeleteEntry} from 'local_wb_faq/edit';\r\n\r\n/**\r\n * Gets called from mustache template.\r\n * @param {*} data\r\n */\r\nexport const init = (data) => {\r\n\r\n    addEvents(data);\r\n    renderforcache(data);\r\n};\r\n\r\n/**\r\n * adds Evente to toggle switch\r\n * @param {*} data\r\n */\r\nfunction addEvents(data) {\r\n    let select = document.getElementById('local_wb_faq_admin');\r\n    select.addEventListener('click', (e) => {\r\n        if (e.target.hasAttribute('data-action')) {\r\n            e.target.setAttribute('disabled', 'disabled');\r\n            if (e.target.dataset.action == \"goto\") {\r\n\r\n                render(e.target.dataset.targetid, data);\r\n            }\r\n            if (e.target.dataset.action == \"quickedit\") {\r\n\r\n                renderedit(e.target.dataset.targetid, e.target.dataset.type, data);\r\n            }\r\n            if (e.target.dataset.action == \"delete\") {\r\n\r\n                // eslint-disable-next-line no-console\r\n                console.log('we want to delete', e.target.dataset.targetid);\r\n\r\n                confirmDeleteEntry(e);\r\n\r\n                // e.target.closest('tr').remove();\r\n                // deleteEntry(e.target.dataset.targetid);\r\n            }\r\n            e.target.removeAttribute('disabled');\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * Renders template from jsonobject for the categoryid\r\n * @param {*} id\r\n * @param {*} data\r\n */\r\nfunction render(id, data) {\r\n    // Load the specific category data\r\n    let json = data[id];\r\n    // Select Container\r\n    let container = document.getElementById('local_wb_faq_admincontent');\r\n    // Render\r\n    Templates.renderForPromise('local_wb_faq/admincontent', json).then(({html}) => {\r\n        container.insertAdjacentHTML('beforeend', html);\r\n        return;\r\n    }).catch(e => {\r\n        // eslint-disable-next-line no-console\r\n        console.log(e);\r\n    });\r\n}\r\n\r\n/**\r\n * Renders template from asd for the categoryid\r\n * @param {*} id\r\n */\r\n export function deleteEntry(id) {\r\n    Ajax.call([{\r\n        methodname: \"local_wb_faq_delete_entry\",\r\n        args: {\r\n            'id': id\r\n        },\r\n        done: function(result) {\r\n\r\n            // eslint-disable-next-line no-console\r\n            console.log('deleted', result, id);\r\n            return;\r\n        },\r\n    }]);\r\n}\r\n\r\n/**\r\n * Renders template from asd for the categoryid\r\n * @param {*} id\r\n */\r\n export function toggleVisibility(id) {\r\n    Ajax.call([{\r\n        methodname: \"local_wb_faq_toggle_entry_visibility\",\r\n        args: {\r\n            'id': id\r\n        },\r\n        done: function(result) {\r\n\r\n            // eslint-disable-next-line no-console\r\n            console.log('toggled', result, id);\r\n            return;\r\n        },\r\n    }]);\r\n}\r\n\r\n/**\r\n * Render edit\r\n * @param {*} id\r\n * @param {*} type\r\n */\r\nfunction renderedit(id, type) {\r\n\r\n    // eslint-disable-next-line no-console\r\n    console.log(\"renderedit\", id, type);\r\n\r\n    let json = {'id': type + '-' + id};\r\n    let container = document.querySelector('#local_wb_faq_admin .view-' + type + '-' + id);\r\n    let editrow = '#local_wb_faq_admin .edit-' + type + '-' + id;\r\n    let td = '#local_wb_faq_admin .edit-' + type + '-' + id + ' td';\r\n    let hidden = 'hidden';\r\n    if (id == 0) {\r\n        editrow = '#local_wb_faq_admin #local_wb_faq_new_entry form';\r\n        container = document.querySelector('#local_wb_faq_new_entry');\r\n        td = '#local_wb_faq_admin #local_wb_faq_new_entry';\r\n        hidden = 'addnew';\r\n    }\r\n\r\n    Templates.renderForPromise('local_wb_faq/quickedit', json).then(({html}) => {\r\n        container.insertAdjacentHTML('afterend', html);\r\n        container.classList.add(hidden);\r\n        return;\r\n    }).then(() => {\r\n\r\n        let dynamicForm = null;\r\n\r\n        if (type == 1) {\r\n            dynamicForm = new DynamicForm(document.querySelector(td), 'local_wb_faq\\\\form\\\\editQuestionForm');\r\n        } else {\r\n            dynamicForm = new DynamicForm(document.querySelector(td), 'local_wb_faq\\\\form\\\\editCategoriesForm');\r\n        }\r\n        dynamicForm.load({\r\n            'id': id,\r\n            'type': type\r\n            });\r\n        return dynamicForm;\r\n    }).then((dynamicForm) => {\r\n        dynamicForm.addEventListener(dynamicForm.events.FORM_SUBMITTED, (e) => {\r\n            e.preventDefault();\r\n            container.classList.remove(hidden);\r\n            document.querySelector(editrow).remove();\r\n            window.location.reload();\r\n        });\r\n        dynamicForm.addEventListener(dynamicForm.events.FORM_CANCELLED, (e) => {\r\n            e.preventDefault();\r\n            container.classList.remove(hidden);\r\n            document.querySelector(editrow).remove();\r\n        });\r\n        return;\r\n    }).catch(e => {\r\n        // eslint-disable-next-line no-console\r\n        console.log(e);\r\n    });\r\n}\r\n\r\n/**\r\n *\r\n * @param {object} json\r\n */\r\nfunction renderforcache(json) {\r\n    Templates.renderForPromise('local_wb_faq/quickedit', json[1]);\r\n}\r\n"],"names":["id","call","methodname","args","done","result","console","log","data","json","document","getElementById","addEventListener","e","target","hasAttribute","setAttribute","dataset","action","container","renderForPromise","then","_ref","html","insertAdjacentHTML","catch","render","targetid","type","querySelector","editrow","td","hidden","_ref2","classList","add","dynamicForm","DynamicForm","load","events","FORM_SUBMITTED","preventDefault","remove","window","location","reload","FORM_CANCELLED","renderedit","removeAttribute","addEvents"],"mappings":";;;;;2FA6F6BA,kBACpBC,KAAK,CAAC,CACPC,WAAY,4BACZC,KAAM,IACIH,IAEVI,KAAM,SAASC,QAGXC,QAAQC,IAAI,UAAWF,OAAQL,iEAUTA,kBACzBC,KAAK,CAAC,CACPC,WAAY,uCACZC,KAAM,IACIH,IAEVI,KAAM,SAASC,QAGXC,QAAQC,IAAI,UAAWF,OAAQL,2JA1FtBQ,WA+JGC,eArJLD,MACFE,SAASC,eAAe,sBAC9BC,iBAAiB,SAAUC,IAC1BA,EAAEC,OAAOC,aAAa,iBACtBF,EAAEC,OAAOE,aAAa,WAAY,YACH,QAA3BH,EAAEC,OAAOG,QAAQC,iBA4BjBlB,GAAIQ,UAEZC,KAAOD,KAAKR,IAEZmB,UAAYT,SAASC,eAAe,gDAE9BS,iBAAiB,4BAA6BX,MAAMY,MAAKC,WAACC,KAACA,WACjEJ,UAAUK,mBAAmB,YAAaD,SAE3CE,OAAMZ,IAELP,QAAQC,IAAIM,MArCJa,CAAOb,EAAEC,OAAOG,QAAQU,SAAUnB,MAEP,aAA3BK,EAAEC,OAAOG,QAAQC,iBAkFblB,GAAI4B,MAGpBtB,QAAQC,IAAI,aAAcP,GAAI4B,UAE1BnB,KAAO,IAAOmB,KAAO,IAAM5B,IAC3BmB,UAAYT,SAASmB,cAAc,6BAA+BD,KAAO,IAAM5B,IAC/E8B,QAAU,6BAA+BF,KAAO,IAAM5B,GACtD+B,GAAK,6BAA+BH,KAAO,IAAM5B,GAAK,MACtDgC,OAAS,SACH,GAANhC,KACA8B,QAAU,mDACVX,UAAYT,SAASmB,cAAc,2BACnCE,GAAK,8CACLC,OAAS,6BAGHZ,iBAAiB,yBAA0BX,MAAMY,MAAKY,YAACV,KAACA,YAC9DJ,UAAUK,mBAAmB,WAAYD,MACzCJ,UAAUe,UAAUC,IAAIH,WAEzBX,MAAK,SAEAe,YAAc,YAGdA,YADQ,GAARR,KACc,IAAIS,qBAAY3B,SAASmB,cAAcE,IAAK,wCAE5C,IAAIM,qBAAY3B,SAASmB,cAAcE,IAAK,0CAE9DK,YAAYE,KAAK,IACPtC,QACE4B,OAELQ,eACRf,MAAMe,cACLA,YAAYxB,iBAAiBwB,YAAYG,OAAOC,gBAAiB3B,IAC7DA,EAAE4B,iBACFtB,UAAUe,UAAUQ,OAAOV,QAC3BtB,SAASmB,cAAcC,SAASY,SAChCC,OAAOC,SAASC,YAEpBT,YAAYxB,iBAAiBwB,YAAYG,OAAOO,gBAAiBjC,IAC7DA,EAAE4B,iBACFtB,UAAUe,UAAUQ,OAAOV,QAC3BtB,SAASmB,cAAcC,SAASY,eAGrCjB,OAAMZ,IAELP,QAAQC,IAAIM,MAlIJkC,CAAWlC,EAAEC,OAAOG,QAAQU,SAAUd,EAAEC,OAAOG,QAAQW,MAE5B,UAA3Bf,EAAEC,OAAOG,QAAQC,SAGjBZ,QAAQC,IAAI,oBAAqBM,EAAEC,OAAOG,QAAQU,uCAE/Bd,IAKvBA,EAAEC,OAAOkC,gBAAgB,gBA/BjCC,CAAUzC,MA6JUC,KA5JLD,wBA6JLY,iBAAiB,yBAA0BX,KAAK"}