{"version":3,"file":"faqnavbar.min.js","sources":["../src/faqnavbar.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/*\n * @package    local_wunderbyte_table\n * @copyright  Wunderbyte GmbH <info@wunderbyte.at>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n//\nimport {get_strings as getstrings} from \"core/str\";\nimport Ajax from \"core/ajax\";\nimport Templates from \"core/templates\";\nimport MyModal from 'local_wb_faq/custommodal';\nimport ModalFactory from 'core/modal_factory';\n// Import ModalEvents from 'core/modal_events'.\n\nvar modal = null;\nvar counterlimit = 0; // Can be overridden.\nvar counter = 0;\n\nvar SELECTORS = {\n  TABS: 'faq-page-navbar-tab a.nav-link',\n  FAQTAB: '#faq-nav-pillsone-tab',\n  SUPPORTMESSAGEBUTTON: '[data-id=\"supportmessage-form\"]',\n  THANKYOUTAB: '#faq-nav-pillsthree-tab',\n};\n\n/**\n * Gets called from mustache template.\n *\n */\nexport function init() {\n\n  addEvents();\n}\n\n/**\n * Function to increase counter. Also enables message tab, if counter is high enough.\n */\n/**\n *\n * @param {boolean} max\n */\nexport function increaseCounter(max = false) {\n\n  // If max is true, we enable message.\n  if (max) {\n    counter = counterlimit;\n  }\n\n  counter++;\n\n  if (counter >= counterlimit) {\n    const tabs = document.querySelectorAll(SELECTORS.SUPPORTMESSAGEBUTTON);\n\n    tabs.forEach(tab => {\n      tab.classList.remove('hidden');\n    });\n  }\n}\n\n/**\n * Adds Evente to menu button\n */\nasync function addEvents() {\n  let button = document.querySelector(\"[data-id='wb-faq-navbar-open-modal']\");\n\n  if (!button) {\n\n    return;\n  }\n\n  if (button.initialized) {\n    return;\n  }\n\n  button.initialized = true;\n\n  button.addEventListener('click', async () => {\n\n    Ajax.call([\n      {\n        methodname: \"local_wb_faq_get_faq_data\",\n        args: {},\n        done: async function(faqdata) {\n\n          if (button.dataset.supportthankyou.length > 0) {\n            faqdata.thankyou = button.dataset.supportthankyou;\n          }\n          const data = await returnDataForModal(faqdata);\n\n          if (!modal) {\n            createModal(data, modal);\n          } else {\n            modal.show();\n          }\n\n        },\n        fail: function(ex) {\n          // eslint-disable-next-line no-console\n          console.log(ex);\n        },\n      },\n    ]);\n  });\n}\n\n/**\n * Function to create modal from data.\n * @param {*} data\n */\nasync function createModal(data) {\n\n  modal = await ModalFactory.create({\n    type: MyModal.TYPE,\n    large: true,\n    body: Templates.render('local_wb_faq/navbar/body', data),\n    footer: '',\n  }).then(modal => {\n    modal.setRemoveOnClose(false);\n\n    return modal;\n  }).catch(e => {\n    // eslint-disable-next-line no-console\n    console.error(e);\n  });\n\n  modal.show();\n}\n\n/**\n * Function do create the data structure for the modal.\n * @param {*} faqdata\n * @returns {object}\n */\nasync function returnDataForModal(faqdata) {\n\n  const loadstrings = [\n    {\n      key: 'searchfaqs',\n      component: 'local_wb_faq',\n    },\n  ];\n\n  const strings = await getstrings(loadstrings);\n\n  let data = {\n    tabs: [\n      {\n          \"name\": strings[0],\n          \"id\": 'one',\n          \"active\": true,\n          \"success\": true\n      }\n    ],\n    body: {\n      thankyou: faqdata.thankyou ?? false\n    }\n  };\n\n  data.json = JSON.parse(faqdata.json);\n  data.root = faqdata.root;\n  data.uid = faqdata.uid;\n  data.canedit = false;\n  data.allowedit = false;\n\n  return data;\n}"],"names":["_interopRequireDefault","obj","__esModule","default","max","arguments","length","undefined","counter","counterlimit","document","querySelectorAll","SELECTORS","SUPPORTMESSAGEBUTTON","forEach","tab","classList","remove","async","button","querySelector","initialized","addEventListener","Ajax","call","methodname","args","done","faqdata","dataset","supportthankyou","thankyou","data","loadstrings","key","component","tabs","name","getstrings","id","active","success","body","json","JSON","parse","root","uid","canedit","allowedit","returnDataForModal","modal","show","ModalFactory","create","type","MyModal","TYPE","large","Templates","render","footer","then","setRemoveOnClose","catch","e","console","error","createModal","fail","ex","log","addEvents","_ajax","_templates","_custommodal","_modal_factory","TABS","FAQTAB","THANKYOUTAB"],"mappings":"0MA0B8C,SAAAA,uBAAAC,YAAAA,KAAAA,IAAAC,WAAAD,KAAAE,QAAAF;;;;;sFA8BvC,WAAsC,IAAbG,IAAGC,UAAAC,eAAAC,IAAAF,cAAAA,aAG7BD,MACFI,QAAUC,cAKZ,KAFAD,SAEeC,aAAc,CACdC,SAASC,iBAAiBC,UAAUC,sBAE5CC,SAAQC,MACXA,IAAIC,UAAUC,OAAO,SAAS,oBAzB7B,YAiCPC,iBACE,IAAIC,OAAST,SAASU,cAAc,wCAEpC,IAAKD,OAEH,OAGF,GAAIA,OAAOE,YACT,OAGFF,OAAOE,aAAc,EAErBF,OAAOG,iBAAiB,SAASJ,UAE/BK,cAAKC,KAAK,CACR,CACEC,WAAY,4BACZC,KAAM,GACNC,KAAMT,eAAeU,SAEfT,OAAOU,QAAQC,gBAAgBxB,OAAS,IAC1CsB,QAAQG,SAAWZ,OAAOU,QAAQC,iBAEpC,MAAME,WA8ChBd,eAAkCU,SAEhC,MAAMK,YAAc,CAClB,CACEC,IAAK,aACLC,UAAW,iBAMf,IAAIH,KAAO,CACTI,KAAM,CACJ,CACIC,YALc,EAAAC,kBAAWL,cAKT,GAChBM,GAAM,MACNC,QAAU,EACVC,SAAW,IAGjBC,KAAM,CACJX,SAAUH,QAAQG,WAAY,IAUlC,OANAC,KAAKW,KAAOC,KAAKC,MAAMjB,QAAQe,MAC/BX,KAAKc,KAAOlB,QAAQkB,KACpBd,KAAKe,IAAMnB,QAAQmB,IACnBf,KAAKgB,SAAU,EACfhB,KAAKiB,WAAY,EAEVjB,KA7EoBkB,CAAmBtB,SAEjCuB,MAGHA,MAAMC,OAiBlBlC,eAA2Bc,MAEzBmB,YAAcE,uBAAaC,OAAO,CAChCC,KAAMC,qBAAQC,KACdC,OAAO,EACPhB,KAAMiB,mBAAUC,OAAO,2BAA4B5B,MACnD6B,OAAQ,KACPC,MAAKX,QACNA,MAAMY,kBAAiB,GAEhBZ,SACNa,OAAMC,IAEPC,QAAQC,MAAMF,EAAE,IAGlBd,MAAMC,OAnCIgB,CAAYpC,OAMhBqC,KAAM,SAASC,IAEbJ,QAAQK,IAAID,OAGhB,IAtEJE,IAvBFC,MAAAzE,uBAAAyE,OACAC,WAAA1E,uBAAA0E,YACAC,aAAA3E,uBAAA2E,cACAC,eAAA5E,uBAAA4E,gBAGA,IAAIzB,MAAQ,KACR1C,aAAe,EACfD,QAAU,EAEVI,UAAY,CACdiE,KAAM,iCACNC,OAAQ,wBACRjE,qBAAsB,kCACtBkE,YAAa,0BA+Id"}