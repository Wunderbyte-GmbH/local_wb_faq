{"version":3,"file":"reordering.min.js","sources":["../src/reordering.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript for sorting columns in question bank view.\n *\n * @copyright  2022 Wunderbyte GmbH\n * @author     Thomas Winkler\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n import {call as fetchMany} from 'core/ajax';\n import SortableList from 'core/sortable_list';\n import jQuery from 'jquery';\n\n /**\n  * Sets up sortable list in the column sort order page.\n  * @param {Element} listRoot\n  * @param {String} identifier\n  */\n const initSortableLists = (listRoot, identifier) => {\n     new SortableList(listRoot);\n\n     jQuery(identifier + ' > *').on(SortableList.EVENTS.DROP, function(evt, info) {\n        if (info.positionChanged) {\n            const ids = getIdOrder(listRoot);\n            reorder(ids);\n            listRoot.querySelectorAll('.li').forEach(item => item.classList.remove('active'));\n        }\n     });\n\n     jQuery(identifier + ' > *').on(SortableList.EVENTS.DRAGSTART, (event) => {\n         event.currentTarget.classList.add('active');\n     });\n };\n\n /**\n  * Call external function set_order - inserts the updated column in the config_plugins table.\n  *\n  * @param {Array} ids String that contains column order.\n  * @returns {Promise}\n  */\n const reorder = ids => fetchMany([{\n     methodname: 'local_wb_faq_set_wbfaq_order',\n     args: {ids},\n }])[0];\n\n /**\n  * Gets the newly reordered columns to display in the question bank view.\n  * @param {Element} listRoot\n  * @returns {Array}\n  */\n const getIdOrder = listRoot => {\n     const columns = Array.from(listRoot.querySelectorAll('li[data-id]'))\n         .map(column => column.dataset.id);\n    columns.pop();\n    return columns;\n };\n\n /**\n  * Initialize module\n  * @param {String} identifier unique class or id with # . for columns.\n  */\n export const init = identifier => {\n     const listRoot = document.querySelector(`${identifier}`);\n     initSortableLists(listRoot, identifier);\n };\n"],"names":["reorder","ids","methodname","args","getIdOrder","listRoot","columns","Array","from","querySelectorAll","map","column","dataset","id","pop","identifier","SortableList","on","EVENTS","DROP","evt","info","positionChanged","forEach","item","classList","remove","DRAGSTART","event","currentTarget","add","initSortableLists","document","querySelector"],"mappings":";;;;;;;sLAsDOA,QAAUC,MAAO,cAAU,CAAC,CAC9BC,WAAY,+BACZC,KAAM,CAACF,IAAAA,QACP,GAOEG,WAAaC,iBACTC,QAAUC,MAAMC,KAAKH,SAASI,iBAAiB,gBAChDC,KAAIC,QAAUA,OAAOC,QAAQC,YACnCP,QAAQQ,MACDR,uBAOUS,aA3CM,EAACV,SAAUU,kBAC7BC,uBAAaX,8BAEVU,WAAa,QAAQE,GAAGD,uBAAaE,OAAOC,MAAM,SAASC,IAAKC,SAChEA,KAAKC,gBAAiB,OAChBrB,IAAMG,WAAWC,UACvBL,QAAQC,KACRI,SAASI,iBAAiB,OAAOc,SAAQC,MAAQA,KAAKC,UAAUC,OAAO,oCAIvEX,WAAa,QAAQE,GAAGD,uBAAaE,OAAOS,WAAYC,QAC3DA,MAAMC,cAAcJ,UAAUK,IAAI,cAiCtCC,CADiBC,SAASC,wBAAiBlB,aACfA"}