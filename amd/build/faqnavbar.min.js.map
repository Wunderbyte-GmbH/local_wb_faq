{"version":3,"file":"faqnavbar.min.js","sources":["../src/faqnavbar.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/*\n * @package    local_wunderbyte_table\n * @copyright  Wunderbyte GmbH <info@wunderbyte.at>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n//\nimport {get_strings as getstrings} from \"core/str\";\nimport Config from \"core/config\";\nimport Ajax from \"core/ajax\";\nimport Templates from \"core/templates\";\nimport MyModal from 'local_wb_faq/custommodal';\nimport ModalFactory from 'core/modal_factory';\n// Import ModalEvents from 'core/modal_events'.\n\nvar modal = null;\nvar counterlimit = 3; // Can be overridden.\nvar counter = 0;\n\nvar SELECTORS = {\n  TABS: 'faq-page-navbar-tab a.nav-link',\n  FAQTAB: '#faq-nav-pillsone-tab',\n  MESSAGETAB: '#faq-nav-pillstwo-tab',\n  THANKYOUTAB: '#faq-nav-pillsthree-tab',\n};\n\n/**\n * Gets called from mustache template.\n *\n */\nexport function init() {\n\n  // eslint-disable-next-line no-console\n  console.log('init navbar called');\n  // eslint-disable-next-line no-console\n  console.log(Config);\n\n  addEvents();\n}\n\n/**\n * Function to increase counter. Also enables message tab, if counter is high enough.\n */\n/**\n *\n * @param {boolean} max\n */\nexport function increaseCounter(max = false) {\n\n  // If max is true, we enable message.\n  if (max) {\n    counter = counterlimit;\n  }\n\n  counter++;\n\n  // eslint-disable-next-line no-console\n  console.log('counter', counter);\n\n  if (counter >= counterlimit) {\n    const tabs = document.querySelectorAll(SELECTORS.MESSAGETAB);\n\n    tabs.forEach(tab => {\n      tab.classList.remove('disabled');\n    });\n  }\n}\n\n/**\n * Adds Evente to menu button\n */\nasync function addEvents() {\n  let button = document.querySelector(\"[data-id='wb-faq-navbar-open-modal']\");\n\n  if (!button) {\n\n    // eslint-disable-next-line no-console\n    console.log('couldnt find button');\n\n    return;\n  }\n\n  if (button.initialized) {\n    return;\n  }\n\n  button.initialized = true;\n\n  // eslint-disable-next-line no-console\n  console.log('found button', button);\n\n  button.addEventListener('click', async e => {\n\n    // eslint-disable-next-line no-console\n    console.log('found e', e);\n\n    Ajax.call([\n      {\n        methodname: \"local_wb_faq_get_faq_data\",\n        args: {},\n        done: async function(faqdata) {\n\n          if (button.dataset.supportthankyou.length > 0) {\n            faqdata.thankyou = button.dataset.supportthankyou;\n          }\n          const data = await returnDataForModal(faqdata);\n\n          if (!modal) {\n            createModal(data, modal);\n          } else {\n            modal.show();\n          }\n\n        },\n        fail: function(ex) {\n          // eslint-disable-next-line no-console\n          console.log(ex);\n        },\n      },\n    ]);\n  });\n}\n\n/**\n * Function to create modal from data.\n * @param {*} data\n */\nasync function createModal(data) {\n\n  modal = await ModalFactory.create({\n    type: MyModal.TYPE,\n    large: true,\n    body: Templates.render('local_wb_faq/navbar/body', data),\n    footer: '',\n  }).then(modal => {\n    modal.setRemoveOnClose(false);\n\n    return modal;\n  }).catch(e => {\n    // eslint-disable-next-line no-console\n    console.error(e);\n  });\n\n  modal.show();\n}\n\n/**\n * Function do create the data structure for the modal.\n * @param {*} faqdata\n * @returns {object}\n */\nasync function returnDataForModal(faqdata) {\n\n  const loadstrings = [\n    {\n      key: 'searchfaqs',\n      component: 'local_wb_faq',\n    },\n    {\n      key: 'writemessage',\n      component: 'local_wb_faq',\n    },\n    {\n      key: 'thankyou',\n      component: 'local_wb_faq',\n    },\n  ];\n\n  const strings = await getstrings(loadstrings);\n\n  let data = {\n    tabs: [\n      {\n          \"name\": strings[0],\n          \"id\": 'one',\n          \"active\": true,\n          \"success\": true\n      },\n      {\n        \"name\": strings[1],\n        \"id\": 'two',\n        \"active\": false,\n        \"success\": false\n      },\n      {\n        \"name\": strings[2],\n        \"id\": 'three',\n        \"active\": false,\n        \"success\": false\n      }\n    ],\n    body: {\n      thankyou: faqdata.thankyou ?? false\n    }\n  };\n\n  data.json = JSON.parse(faqdata.json);\n  data.root = faqdata.root;\n  data.uid = faqdata.uid;\n  data.canedit = false;\n  data.allowedit = false;\n\n  return data;\n}"],"names":["max","counter","console","log","document","querySelectorAll","SELECTORS","forEach","tab","classList","remove","Config","button","querySelector","initialized","addEventListener","async","e","call","methodname","args","done","faqdata","dataset","supportthankyou","length","thankyou","data","loadstrings","key","component","strings","tabs","body","json","JSON","parse","root","uid","canedit","allowedit","returnDataForModal","modal","show","ModalFactory","create","type","MyModal","TYPE","large","Templates","render","footer","then","setRemoveOnClose","catch","error","createModal","fail","ex","addEvents"],"mappings":";;;;;qGA8DgCA,4DAG1BA,MACFC,QAnCe,MAsCjBA,UAGAC,QAAQC,IAAI,UAAWF,SAEnBA,SA3Ca,EA2CY,CACdG,SAASC,iBAAiBC,sBAElCC,SAAQC,MACXA,IAAIC,UAAUC,OAAO,0CA9BzBR,QAAQC,IAAI,sBAEZD,QAAQC,IAAIQ,sCAqCRC,OAASR,SAASS,cAAc,4CAE/BD,mBAGHV,QAAQC,IAAI,0BAKVS,OAAOE,mBAIXF,OAAOE,aAAc,EAGrBZ,QAAQC,IAAI,eAAgBS,QAE5BA,OAAOG,iBAAiB,SAASC,MAAAA,IAG/Bd,QAAQC,IAAI,UAAWc,iBAElBC,KAAK,CACR,CACEC,WAAY,4BACZC,KAAM,GACNC,KAAML,eAAeM,SAEfV,OAAOW,QAAQC,gBAAgBC,OAAS,IAC1CH,QAAQI,SAAWd,OAAOW,QAAQC,uBAE9BG,0BA8CkBL,qCAE1BM,YAAc,CAClB,CACEC,IAAK,aACLC,UAAW,gBAEb,CACED,IAAK,eACLC,UAAW,gBAEb,CACED,IAAK,WACLC,UAAW,iBAITC,cAAgB,oBAAWH,iBAE7BD,KAAO,CACTK,KAAM,CACJ,MACYD,QAAQ,MACV,cACI,WACC,GAEf,MACUA,QAAQ,MACV,cACI,WACC,GAEb,MACUA,QAAQ,MACV,gBACI,WACC,IAGfE,KAAM,CACJP,mCAAUJ,QAAQI,kEAItBC,KAAKO,KAAOC,KAAKC,MAAMd,QAAQY,MAC/BP,KAAKU,KAAOf,QAAQe,KACpBV,KAAKW,IAAMhB,QAAQgB,IACnBX,KAAKY,SAAU,EACfZ,KAAKa,WAAY,EAEVb,KAjGoBc,CAAmBnB,SAEjCoB,MAGHA,MAAMC,sBAiBShB,MAEzBe,YAAcE,uBAAaC,OAAO,CAChCC,KAAMC,qBAAQC,KACdC,OAAO,EACPhB,KAAMiB,mBAAUC,OAAO,2BAA4BxB,MACnDyB,OAAQ,KACPC,MAAKX,QACNA,MAAMY,kBAAiB,GAEhBZ,SACNa,OAAMtC,IAEPf,QAAQsD,MAAMvC,MAGhByB,MAAMC,OAnCIc,CAAY9B,OAMhB+B,KAAM,SAASC,IAEbzD,QAAQC,IAAIwD,WA/EpBC,0OAtBElB,MAAQ,KAERzC,QAAU,EAEVK,qBAGU"}