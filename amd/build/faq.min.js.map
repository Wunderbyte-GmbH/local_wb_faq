{"version":3,"file":"faq.min.js","sources":["../src/faq.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/*\n * @package    local_wunderbyte_table\n * @copyright  Wunderbyte GmbH <info@wunderbyte.at>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Templates from \"core/templates\";\nimport {get_string as getString} from \"core/str\";\nimport Ajax from \"core/ajax\";\n\nvar clicks = 0;\n\n/**\n * Gets called from mustache template.\n *\n * @param {*} data\n * @param {integer} root\n * @param {string} uid\n */\nexport const init = (data, root, uid) => {\n  clicks = 0;\n  // eslint-disable-next-line no-console\n  console.log(\"faq.js \", uid);\n  render(root, data, uid);\n  addEvents(data, root, uid);\n};\n\n/**\n * Adds Evente to toggle switch\n * @param {*} data\n * @param {integer} root\n * @param {string} uid\n */\nfunction addEvents(data, root, uid) {\n  let select = document.querySelector(\".local_wb_faq_container-\" + uid);\n  if (select.listener) {\n    select.removeEventListener(\"click\", select.listener);\n  }\n  if (select) {\n    select.addEventListener(\n      \"click\",\n      (select.listener = (e) => {\n        let button = e.target;\n        if (button.dataset.toggle == \"faqcollapse\") {\n          clicks++;\n          // eslint-disable-next-line no-console\n          console.log(clicks);\n          if (button.classList.contains(\"collapsed\")) {\n            button.classList.remove(\"collapsed\");\n            document.querySelector(button.dataset.target).classList.add(\"show\");\n            document\n              .querySelector(button.dataset.target)\n              .classList.remove(\"hide\");\n          } else {\n            button.classList.add(\"collapsed\");\n            document.querySelector(button.dataset.target).classList.add(\"hide\");\n            document\n              .querySelector(button.dataset.target)\n              .classList.remove(\"show\");\n          }\n        }\n        if (e.target.dataset.action == \"goto\") {\n          render(e.target.dataset.targetid, data, uid);\n        }\n      })\n    );\n  }\n\n  let searchbox = document.querySelector(\".wb_faq_searchbox-\" + uid);\n\n  // eslint-disable-next-line no-console\n  console.log(\"searchbox\", searchbox);\n\n  if (searchbox) {\n    searchbox.addEventListener(\"click\", (e) => {\n      let button = e.target;\n      // eslint-disable-next-line no-console\n      if (button.dataset.toggle == \"faqcollapse\") {\n        clicks++;\n\n        if (button.classList.contains(\"collapsed\")) {\n          button.classList.remove(\"collapsed\");\n          document.querySelector(button.dataset.target).classList.add(\"show\");\n          document\n            .querySelector(button.dataset.target)\n            .classList.remove(\"hide\");\n        } else {\n          button.classList.add(\"collapsed\");\n          document.querySelector(button.dataset.target).classList.add(\"hide\");\n          document\n            .querySelector(button.dataset.target)\n            .classList.remove(\"show\");\n        }\n      }\n      if (e.target.dataset.action == \"goto\") {\n        render(e.target.dataset.targetid, data, uid);\n        document\n          .querySelector(\".local_wb_faq-\" + uid)\n          .scrollIntoView({ block: \"start\", behavior: \"smooth\" });\n      }\n    });\n  }\n\n  let category = document.querySelector(\"#id_categorypicker\");\n\n  if (category) {\n    category.addEventListener(\"change\", () => {\n      let faqid = category.value;\n      if (category.value == \"\") {\n        faqid = root;\n      }\n\n      render(faqid, data);\n    });\n  }\n}\n\n/**\n * Renders template from jsonobject for the categoryid\n * @param {integer} id\n * @param {*} data\n * @param {string} uid\n */\nfunction render(id, data, uid) {\n  let json = JSON.parse(data);\n  let templatedata = json[id];\n  templatedata.root = id;\n  templatedata.uid = uid;\n\n  if (!templatedata || !templatedata.hasOwnProperty(\"parentid\")) {\n    return;\n  }\n\n  if (json[templatedata.parentid].title) {\n    templatedata.parenttitle = json[templatedata.parentid].title;\n  }\n  if (templatedata.parentid == \"\") {\n    templatedata.parenttitle = getString(\"faq\", \"local_wb_faq\");\n  }\n\n  // Select Container\n  let container = document.querySelector(\".local_wb_faq-\" + uid);\n  // Empty Container\n  container.innerHTML = \"\";\n  // Render\n  Templates.renderForPromise(\"local_wb_faq/faq\", templatedata)\n    .then(({ html, js }) => {\n      html = '<div class=\"local_wb_faq-' + uid + '\">' + html + \"</div>\";\n      Templates.replaceNode(\".local_wb_faq-\" + uid, html, js);\n      return;\n    })\n    .catch((e) => {\n      // eslint-disable-next-line no-console\n      console.log(e);\n    });\n}\n\n/**\n * Calls WS Function to get new data after new entries are added\n * @param {string} uid\n * @param {integer} parentid\n */\nexport const reloadData = (uid, parentid) => {\n  loadData(uid, parentid);\n};\n\nconst loadData = (uid, parentid) =>\n  Ajax.call([\n    {\n      methodname: \"local_wb_faq_get_faq_data\",\n      args: {},\n      done: function (data) {\n        let newdata = JSON.parse(data.json);\n        addEvents(newdata, parentid, uid);\n        render(parentid, newdata, uid);\n      },\n      fail: function (ex) {\n        // eslint-disable-next-line no-console\n        console.log(ex);\n      },\n    },\n  ]);\n"],"names":["clicks","addEvents","data","root","uid","select","document","querySelector","listener","removeEventListener","addEventListener","e","button","target","dataset","toggle","console","log","classList","contains","remove","add","action","render","targetid","searchbox","scrollIntoView","block","behavior","category","faqid","value","id","json","JSON","parse","templatedata","hasOwnProperty","parentid","title","parenttitle","innerHTML","renderForPromise","then","_ref","html","js","replaceNode","catch","loadData","Ajax","call","methodname","args","done","newdata","fail","ex"],"mappings":"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"}