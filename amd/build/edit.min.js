define("local_wb_faq/edit",["exports","core_form/modalform","core/modal_factory","core/modal_events","core/str","local_wb_faq/notifications","local_wb_faq/admin"],(function(_exports,_modalform,_modal_factory,_modal_events,_str,_notifications,_admin){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/*
   * @package    local_wunderbyte_table
   * @copyright  Wunderbyte GmbH <info@wunderbyte.at>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_modalform=_interopRequireDefault(_modalform),_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events);_exports.init=()=>{console.log("faq init called");document.querySelectorAll(".local_wb_faq_container").forEach((element=>{element.dataset.initialized?console.log("unnecessary call of init"):(element.addEventListener("click",editModalListener),element.dataset.initialized=!0)}))};const editModalListener=event=>{console.log("edit.js",event);let button=event.target;"i"===button.tagName.toLowerCase()&&(button=button.parentElement),button.classList.contains("local_wb_faq_edit_question")?(console.log("question"),function(event){let button=event.target,entryid=0;"a"!==button.tagName.toLowerCase()&&(button=button.parentElement);button.dataset.id&&(entryid=button.dataset.id);const modalForm=new _modalform.default({formClass:"local_wb_faq\\form\\editQuestionForm",args:{id:entryid,type:1,nobuttons:!0},modalConfig:{title:(0,_str.get_string)("addquestion","local_wb_faq")},returnFocus:button});modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(e=>{const response=e.detail;console.log("Response of the modal: ",response),(0,_notifications.showSuccessNotification)(),window.location.reload()})),modalForm.show().then((()=>{})).catch((e=>{console.log(e),(0,_notifications.showErrorNotification)()}))}(event)):button.classList.contains("local_wb_faq_delete_question")?(console.log("delete question"),confirmDeleteEntry(event)):button.classList.contains("local_wb_faq_toggle_entry_visibility")||button.classList.contains("local_wb_faq_toggle_category_visibility")?(console.log("toggle visibility"),confirmToggleVisibility(event)):button.classList.contains("local_wb_faq_edit_category")?(console.log("edit category"),openEditCategoriesModal(event)):button.classList.contains("local_wb_faq_delete_category")?(console.log("delete category"),confirmDeleteEntry(event)):button.classList.contains("local_wb_faq_edit_category")?(console.log("category"),openEditCategoriesModal(event)):console.log("no token found")};function openEditCategoriesModal(event){let button=event.target,entryid=0;"a"!==button.tagName.toLowerCase()&&(button=button.parentElement),button.dataset.id&&(entryid=button.dataset.id);const modalForm=new _modalform.default({formClass:"local_wb_faq\\form\\editCategoriesForm",args:{id:entryid,type:0,nobuttons:!0},modalConfig:{title:(0,_str.get_string)("addcategory","local_wb_faq")},returnFocus:button});modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(e=>{const response=e.detail;console.log("Response of the modal: ",response),(0,_notifications.showSuccessNotification)(),window.location.reload()})),modalForm.show().then((()=>{})).catch((e=>{console.log(e),(0,_notifications.showErrorNotification)()}))}function confirmDeleteEntry(event){let button=event.target,entryid=0;if("a"!==button.tagName.toLowerCase()&&(button=button.parentElement),button.classList.contains("local_wb_faq_delete_question"))button.dataset.id&&(entryid=button.dataset.id);else{if(!button.classList.contains("local_wb_faq_delete_category"))return void console.log("no delete entry to delete");button.dataset.id&&(entryid=button.dataset.id)}(0,_str.get_strings)([{key:"confirmdeleteentrytitle",component:"local_wb_faq"},{key:"confirmdeleteentrybody",component:"local_wb_faq"},{key:"confirmdeleteentry",component:"local_wb_faq"}]).then((strings=>(console.log(strings),_modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL}).then((modal=>(modal.setTitle(strings[0]),modal.setBody(strings[1]),modal.setSaveButtonText(strings[2]),modal.getRoot().on(_modal_events.default.save,(function(){let entry=button.closest("div.accordion-item"),elementid=0;entry?elementid=entry.dataset.id:(entry=button.closest('[data-action="goto"]'),elementid=entry.dataset.targetid),elementid==entryid?(entry.remove(),(0,_admin.deleteEntry)(entryid),(0,_notifications.showSuccessNotification)()):console.log("couldnt find right element")})),modal.show(),modal))).catch((e=>{console.log(e),(0,_notifications.showErrorNotification)()})),!0))).catch((e=>{console.log(e),(0,_notifications.showErrorNotification)()}))}function confirmToggleVisibility(event){console.log("confirmToggleVisibility",event.target);let button=event.target,entryid=0;if("a"!==button.tagName.toLowerCase()&&(button=button.parentElement),console.log("ctv",event.target,button.tagName,button),button.classList.contains("local_wb_faq_toggle_entry_visibility"))button.dataset.id&&(entryid=button.dataset.id);else{if(!button.classList.contains("local_wb_faq_toggle_category_visibility"))return void console.log("no entry to toggle");button.dataset.id&&(entryid=button.dataset.id)}(0,_str.get_strings)([{key:"confirmtogglevisibilitytitle",component:"local_wb_faq"},{key:"confirmtogglevisibilitybody",component:"local_wb_faq"},{key:"confirmtogglevisibility",component:"local_wb_faq"}]).then((strings=>(_modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL}).then((modal=>(modal.setTitle(strings[0]),modal.setBody(strings[1]),modal.setSaveButtonText(strings[2]),modal.getRoot().on(_modal_events.default.save,(function(){let entry=button.closest("div.accordion-item"),elementid=0;if(entry?elementid=entry.dataset.id:(entry=button.closest('[data-action="goto"]'),elementid=entry.dataset.targetid),elementid==entryid){(0,_admin.toggleVisibility)(entryid);let ielement=button.querySelector("i.toggle-visibility");console.log(ielement,button.classList),ielement?(ielement.classList.contains("fa-eye-slash")?ielement.classList.replace("fa-eye-slash","fa-eye"):ielement.classList.replace("fa-eye","fa-eye-slash"),(0,_notifications.showSuccessNotification)()):window.location.reload()}else console.log("couldnt find right element")})),modal.show(),modal))).catch((e=>{console.log(e),(0,_notifications.showErrorNotification)()})),!0))).catch((e=>{console.log(e),(0,_notifications.showErrorNotification)()}))}}));

//# sourceMappingURL=edit.min.js.map