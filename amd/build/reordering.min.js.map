{"version":3,"file":"reordering.min.js","sources":["../src/reordering.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript for sorting columns in question bank view.\n *\n * @copyright  2022 Wunderbyte GmbH\n * @author     Thomas Winkler\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n import {call as fetchMany} from 'core/ajax';\n import SortableList from 'core/sortable_list';\n import jQuery from 'jquery';\n\n /**\n  * Sets up sortable list in the column sort order page.\n  * @param {Element} listRoot\n  * @param {String} identifier\n  */\n const initSortableLists = (listRoot, identifier) => {\n     new SortableList(listRoot);\n\n     jQuery(identifier + ' > *').on(SortableList.EVENTS.DROP, function(evt, info) {\n        if (info.positionChanged) {\n            const ids = getIdOrder(listRoot);\n            reorder(ids);\n            listRoot.querySelectorAll('.li').forEach(item => item.classList.remove('active'));\n        }\n     });\n\n     jQuery(identifier + ' > *').on(SortableList.EVENTS.DRAGSTART, (event) => {\n         event.currentTarget.classList.add('active');\n     });\n };\n\n /**\n  * Call external function set_order - inserts the updated column in the config_plugins table.\n  *\n  * @param {Array} ids String that contains column order.\n  * @returns {Promise}\n  */\n const reorder = ids => fetchMany([{\n     methodname: 'local_wb_faq_set_wbfaq_order',\n     args: {ids},\n }])[0];\n\n /**\n  * Gets the newly reordered columns to display in the question bank view.\n  * @param {Element} listRoot\n  * @returns {Array}\n  */\n const getIdOrder = listRoot => {\n     const columns = Array.from(listRoot.querySelectorAll('li[data-id]'))\n         .map(column => column.dataset.id);\n    columns.pop();\n    return columns;\n };\n\n /**\n  * Initialize module\n  * @param {String} identifier unique class or id with # . for columns.\n  */\n export const init = identifier => {\n     const listRoot = document.querySelector(`${identifier}`);\n     initSortableLists(listRoot, identifier);\n };\n"],"names":["_interopRequireDefault","obj","__esModule","default","_sortable_list","_jquery","reorder","ids","fetchMany","methodname","args","getIdOrder","listRoot","columns","Array","from","querySelectorAll","map","column","dataset","id","pop","_exports","init","identifier","initSortableLists","SortableList","jQuery","on","EVENTS","DROP","evt","info","positionChanged","forEach","item","classList","remove","DRAGSTART","event","currentTarget","add","document","querySelector"],"mappings":"wIAyB6B,SAAAA,uBAAAC,YAAAA,KAAAA,IAAAC,WAAAD,KAAAE,QAAAF;;;;;;;kFAD5BG,eAAAJ,uBAAAI,gBACAC,QAAAL,uBAAAK,SAOA,MAsBMC,QAAUC,MAAO,EAAAC,YAAU,CAAC,CAC9BC,WAAY,+BACZC,KAAM,CAACH,YACP,GAOEI,WAAaC,WACf,MAAMC,QAAUC,MAAMC,KAAKH,SAASI,iBAAiB,gBAChDC,KAAIC,QAAUA,OAAOC,QAAQC,KAEnC,OADAP,QAAQQ,MACDR,OAAO,EAUfS,SAAAC,KAHkBC,aA3CMC,EAACb,SAAUY,cACjC,IAAIE,uBAAad,WAEjB,EAAAe,iBAAOH,WAAa,QAAQI,GAAGF,uBAAaG,OAAOC,MAAM,SAASC,IAAKC,MACpE,GAAIA,KAAKC,gBAAiB,CACtB,MAAM1B,IAAMI,WAAWC,UACvBN,QAAQC,KACRK,SAASI,iBAAiB,OAAOkB,SAAQC,MAAQA,KAAKC,UAAUC,OAAO,iBAI9E,EAAAV,iBAAOH,WAAa,QAAQI,GAAGF,uBAAaG,OAAOS,WAAYC,QAC3DA,MAAMC,cAAcJ,UAAUK,IAAI,SAAS,GAC7C,EAgCFhB,CADiBiB,SAASC,cAAe,GAAEnB,cACfA,WAAW,CACzC"}